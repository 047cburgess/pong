openapi: 3.0.0
info:
  title: FtTranscendence
  version: 0.0.0
tags:
  - name: Users
  - name: Auth
  - name: Friends
  - name: Game Stats
  - name: Games
  - name: Tournaments
  - name: Events
paths:
  /events:
    get:
      operationId: Events_events
      description: SSE endpoint
      parameters: []
      responses:
        '200':
          description: The request has succeeded.
        '401':
          description: Access is unauthorized.
      tags:
        - Events
      security:
        - BearerAuth: []
  /games/create:
    post:
      operationId: Games_create
      description: Online custom game request going to MM service. Body contains players that matchmaking service will invite via SSE.
      parameters: []
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GameKey'
        '400':
          description: The server could not understand the request due to invalid syntax.
        '401':
          description: Access is unauthorized.
      tags:
        - Games
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                numberOfPlayers:
                  type: integer
                  format: uint32
                  minimum: 2
                  maximum: 4
                  description: Capacity of the game. Host can invite as many as they like but starts when full.
                invitedPlayerIds:
                  type: array
                  items:
                    type: integer
                    format: uint64
              required:
                - numberOfPlayers
                - invitedPlayerIds
      security:
        - BearerAuth: []
  /games/queue:
    post:
      operationId: Games_queue
      parameters: []
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GameKey'
        '401':
          description: Access is unauthorized.
      tags:
        - Games
      security:
        - BearerAuth: []
  /games/{gameId}/decline:
    delete:
      operationId: Games_decline
      description: Decline game invitation.
      parameters:
        - name: gameId
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: 'There is no content to send for this request, but the headers may be useful. '
        '401':
          description: Access is unauthorized.
        '404':
          description: The server cannot find the requested resource.
      tags:
        - Games
      security:
        - BearerAuth: []
  /games/{gameId}/join:
    post:
      operationId: Games_join
      description: Accept game invitation and receive token for WebSocket connection to game server.
      parameters:
        - name: gameId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GameKey'
        '401':
          description: Access is unauthorized.
        '404':
          description: The server cannot find the requested resource.
        '409':
          description: The request conflicts with the current state of the server.
      tags:
        - Games
      security:
        - BearerAuth: []
  /tournaments/create:
    post:
      operationId: Tournaments_createTournament
      description: Create a new online tournament and invite players to register.
      parameters: []
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TournamentKey'
        '400':
          description: The server could not understand the request due to invalid syntax.
        '401':
          description: Access is unauthorized.
      tags:
        - Tournaments
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                invitedPlayerIds:
                  type: array
                  items:
                    type: integer
                    format: uint64
              required:
                - invitedPlayerIds
      security:
        - BearerAuth: []
  /tournaments/{tournamentId}/decline:
    delete:
      operationId: Tournaments_decline
      description: Decline tournament invite to register.
      parameters:
        - name: tournamentId
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: 'There is no content to send for this request, but the headers may be useful. '
        '401':
          description: Access is unauthorized.
        '404':
          description: The server cannot find the requested resource.
      tags:
        - Tournaments
      security:
        - BearerAuth: []
  /tournaments/{tournamentId}/join:
    post:
      operationId: Tournaments_joinTournament
      description: Join tournament registration. Receives key to join websocket tournament lobby.
      parameters:
        - name: tournamentId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TournamentKey'
        '401':
          description: Access is unauthorized.
        '404':
          description: The server cannot find the requested resource.
        '409':
          description: The request conflicts with the current state of the server.
      tags:
        - Tournaments
      security:
        - BearerAuth: []
  /user:
    get:
      operationId: User_get
      parameters: []
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    format: uint64
                    description: id = 0 is reserved for non-registered users
                  lastSeen:
                    type: string
                    format: date-time
                  registeredSince:
                    type: string
                    format: date-time
                  username:
                    type: string
                  realname:
                    type: string
                  avatarUrl:
                    type: string
                    format: uri
                  email:
                    type: string
                required:
                  - id
                  - username
                  - email
        '304':
          description: The client has made a conditional request and the resource has not been modified.
        '401':
          description: Access is unauthorized.
      tags:
        - Users
      security:
        - BearerAuth: []
    patch:
      operationId: User_update
      parameters: []
      responses:
        '204':
          description: 'There is no content to send for this request, but the headers may be useful. '
        '400':
          description: The server could not understand the request due to invalid syntax.
        '401':
          description: Access is unauthorized.
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/merge-patch+json:
            schema:
              $ref: '#/components/schemas/MergePatchUpdate'
      security:
        - BearerAuth: []
    delete:
      operationId: User_delete
      parameters: []
      responses:
        '204':
          description: 'There is no content to send for this request, but the headers may be useful. '
        '401':
          description: Access is unauthorized.
      tags:
        - Users
      security:
        - BearerAuth: []
  /user/friends:
    get:
      operationId: Friends_list
      description: List friends of the current user
      parameters: []
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User.PublicInfo'
        '304':
          description: The client has made a conditional request and the resource has not been modified.
        '401':
          description: Access is unauthorized.
      tags:
        - Friends
      security:
        - BearerAuth: []
  /user/friends/requests:
    get:
      operationId: FriendRequests_list
      description: List incoming friend requests
      parameters: []
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User.PublicInfo'
        '304':
          description: The client has made a conditional request and the resource has not been modified.
        '401':
          description: Access is unauthorized.
      tags:
        - Friends
      security:
        - BearerAuth: []
  /user/friends/requests/outgoing:
    get:
      operationId: FriendRequests_listOutgoing
      description: List outgoing friend requests
      parameters: []
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User.PublicInfo'
        '304':
          description: The client has made a conditional request and the resource has not been modified.
        '401':
          description: Access is unauthorized.
      tags:
        - Friends
      security:
        - BearerAuth: []
  /user/friends/requests/outgoing/{username}:
    put:
      operationId: FriendRequests_send
      description: Send a friend request
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: 'There is no content to send for this request, but the headers may be useful. '
        '401':
          description: Access is unauthorized.
        '404':
          description: The server cannot find the requested resource.
        '409':
          description: The request conflicts with the current state of the server.
      tags:
        - Friends
      security:
        - BearerAuth: []
    delete:
      operationId: FriendRequests_cancel
      description: Cancel an outgoing friend request
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: 'There is no content to send for this request, but the headers may be useful. '
        '401':
          description: Access is unauthorized.
        '404':
          description: The server cannot find the requested resource.
      tags:
        - Friends
      security:
        - BearerAuth: []
  /user/friends/requests/{username}:
    put:
      operationId: FriendRequests_accept
      description: Accept a friend request
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: 'There is no content to send for this request, but the headers may be useful. '
        '401':
          description: Access is unauthorized.
        '404':
          description: The server cannot find the requested resource.
        '409':
          description: The request conflicts with the current state of the server.
      tags:
        - Friends
      security:
        - BearerAuth: []
    delete:
      operationId: FriendRequests_reject
      description: Reject a friend request from the target user
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: 'There is no content to send for this request, but the headers may be useful. '
        '401':
          description: Access is unauthorized.
        '404':
          description: The server cannot find the requested resource.
      tags:
        - Friends
      security:
        - BearerAuth: []
  /user/friends/{username}:
    get:
      operationId: Friends_state
      description: Check friendship state between the current user and the target
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                type: object
                properties:
                  state:
                    type: string
                    enum:
                      - friends
                      - outgoing
                      - incoming
                required:
                  - state
        '304':
          description: The client has made a conditional request and the resource has not been modified.
        '401':
          description: Access is unauthorized.
        '404':
          description: The server cannot find the requested resource.
      tags:
        - Friends
      security:
        - BearerAuth: []
    delete:
      operationId: Friends_delete
      description: Remove a friend
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
      responses:
        '204':
          description: 'There is no content to send for this request, but the headers may be useful. '
        '401':
          description: Access is unauthorized.
        '404':
          description: The server cannot find the requested resource.
      tags:
        - Friends
      security:
        - BearerAuth: []
  /user/games:
    get:
      operationId: History_games
      description: Get Match history for the current user
      parameters:
        - name: page
          in: query
          required: true
          schema:
            type: integer
            format: uint32
            minimum: 1
            default: 1
          explode: false
        - name: per_page
          in: query
          required: true
          schema:
            type: integer
            format: uint32
            minimum: 1
            maximum: 100
            default: 25
          explode: false
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GameResult'
        '304':
          description: The client has made a conditional request and the resource has not been modified.
        '401':
          description: Access is unauthorized.
      tags:
        - Game Stats
      security:
        - BearerAuth: []
  /user/games/local:
    post:
      operationId: History_submitGame
      description: Submit local game result from front end
      parameters: []
      responses:
        '204':
          description: 'There is no content to send for this request, but the headers may be useful. '
        '400':
          description: The server could not understand the request due to invalid syntax.
        '401':
          description: Access is unauthorized.
      tags:
        - Game Stats
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LocalGameSubmission'
      security:
        - BearerAuth: []
  /user/login:
    post:
      operationId: Auth_login
      parameters: []
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum:
                      - 2fa_required
                required:
                  - status
        '204':
          description: 'There is no content to send for this request, but the headers may be useful. '
        '400':
          description: The server could not understand the request due to invalid syntax.
        '401':
          description: Access is unauthorized.
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                password:
                  type: string
              required:
                - username
                - password
  /user/login/two-factor:
    post:
      operationId: Auth_twoFactor
      parameters: []
      responses:
        '204':
          description: 'There is no content to send for this request, but the headers may be useful. '
        '400':
          description: The server could not understand the request due to invalid syntax.
        '401':
          description: Access is unauthorized.
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
              required:
                - token
  /user/logout:
    post:
      operationId: Auth_logout
      parameters: []
      responses:
        '204':
          description: 'There is no content to send for this request, but the headers may be useful. '
        '401':
          description: Access is unauthorized.
      tags:
        - Auth
  /user/oauth/github:
    get:
      operationId: Auth_oauthGithub
      parameters: []
      responses:
        '204':
          description: 'There is no content to send for this request, but the headers may be useful. '
      tags:
        - Auth
  /user/register:
    post:
      operationId: Auth_register
      parameters: []
      responses:
        '204':
          description: 'There is no content to send for this request, but the headers may be useful. '
        '400':
          description: The server could not understand the request due to invalid syntax.
        '409':
          description: The request conflicts with the current state of the server.
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                realname:
                  type: string
                avatarUrl:
                  type: string
                  format: uri
                email:
                  type: string
                password:
                  type: string
              required:
                - username
                - email
                - password
  /user/stats:
    get:
      operationId: History_stats
      description: Get Game stats for the current user
      parameters: []
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GameStats'
        '304':
          description: The client has made a conditional request and the resource has not been modified.
        '401':
          description: Access is unauthorized.
      tags:
        - Game Stats
      security:
        - BearerAuth: []
  /user/tournaments:
    get:
      operationId: History_tournaments
      description: Get Tournament history for the current user
      parameters:
        - name: page
          in: query
          required: true
          schema:
            type: integer
            format: uint32
            minimum: 1
            default: 1
          explode: false
        - name: per_page
          in: query
          required: true
          schema:
            type: integer
            format: uint32
            minimum: 1
            maximum: 100
            default: 25
          explode: false
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TournamentResult'
        '304':
          description: The client has made a conditional request and the resource has not been modified.
        '401':
          description: Access is unauthorized.
      tags:
        - Game Stats
      security:
        - BearerAuth: []
  /user/tournaments/local:
    post:
      operationId: History_submitTournament
      description: Submit local tournament result from front end
      parameters: []
      responses:
        '204':
          description: 'There is no content to send for this request, but the headers may be useful. '
        '400':
          description: The server could not understand the request due to invalid syntax.
        '401':
          description: Access is unauthorized.
      tags:
        - Game Stats
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LocalTournamentSubmission'
      security:
        - BearerAuth: []
  /users/{username}:
    get:
      operationId: Users_user
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User.PublicInfo'
        '304':
          description: The client has made a conditional request and the resource has not been modified.
        '401':
          description: Access is unauthorized.
        '404':
          description: The server cannot find the requested resource.
      tags:
        - Users
      security:
        - BearerAuth: []
  /users/{username}/friends:
    get:
      operationId: Users_friends
      parameters:
        - name: username
          in: path
          required: true
          schema:
            anyOf:
              - type: string
              - type: integer
                format: uint64
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User.PublicInfo'
        '304':
          description: The client has made a conditional request and the resource has not been modified.
        '401':
          description: Access is unauthorized.
        '404':
          description: The server cannot find the requested resource.
      tags:
        - Friends
      security:
        - BearerAuth: []
  /users/{username}/games:
    get:
      operationId: Users_games
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
        - name: page
          in: query
          required: true
          schema:
            type: integer
            format: uint32
            minimum: 1
            default: 1
          explode: false
        - name: per_page
          in: query
          required: true
          schema:
            type: integer
            format: uint32
            minimum: 1
            maximum: 100
            default: 25
          explode: false
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GameResult'
        '304':
          description: The client has made a conditional request and the resource has not been modified.
        '401':
          description: Access is unauthorized.
        '404':
          description: The server cannot find the requested resource.
      tags:
        - Game Stats
      security:
        - BearerAuth: []
  /users/{username}/stats:
    get:
      operationId: Users_stats
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GameStats'
        '304':
          description: The client has made a conditional request and the resource has not been modified.
        '401':
          description: Access is unauthorized.
        '404':
          description: The server cannot find the requested resource.
      tags:
        - Game Stats
      security:
        - BearerAuth: []
  /users/{username}/tournaments:
    get:
      operationId: Users_tournaments
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
        - name: page
          in: query
          required: true
          schema:
            type: integer
            format: uint32
            minimum: 1
            default: 1
          explode: false
        - name: per_page
          in: query
          required: true
          schema:
            type: integer
            format: uint32
            minimum: 1
            maximum: 50
            default: 20
          explode: false
      responses:
        '200':
          description: The request has succeeded.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/TournamentResult'
        '304':
          description: The client has made a conditional request and the resource has not been modified.
        '401':
          description: Access is unauthorized.
        '404':
          description: The server cannot find the requested resource.
      tags:
        - Game Stats
      security:
        - BearerAuth: []
components:
  schemas:
    FriendRequest:
      type: object
      required:
        - event
        - from
      properties:
        id:
          type: string
        event:
          type: string
          enum:
            - FriendRequest
        from:
          type: string
    GameInvite:
      type: object
      required:
        - event
        - gameId
        - from
      properties:
        id:
          type: string
        event:
          type: string
          enum:
            - GameInvite
        gameId:
          type: string
        from:
          type: integer
          format: uint64
    GameKey:
      type: object
      required:
        - key
        - gameId
        - expires
      properties:
        key:
          type: string
        gameId:
          type: string
        expires:
          type: string
          format: date-time
      description: |-
        `GameKey` is returned by all the endpoints that are opening game websocket connection.
        Since the websocket endpoint cannot have body,
        `GameKey` will be the first message send via the newly established websocket"
    GameResult:
      type: object
      required:
        - id
        - players
        - date
        - duration
      properties:
        id:
          type: string
        players:
          type: array
          items:
            type: object
            properties:
              id:
                anyOf:
                  - type: integer
                    format: uint64
                  - type: string
              score:
                type: integer
                format: int32
            required:
              - id
              - score
          minItems: 2
          maxItems: 4
        winnerId:
          anyOf:
            - type: integer
              format: uint64
            - type: string
          description: Username of the winner or `undefined` if draw
        tournamentId:
          type: string
        date:
          type: string
          format: date-time
        duration:
          type: string
          format: duration
    GameStats:
      type: object
      required:
        - lifetime
        - daily
        - recentMatches
        - recentTournaments
      properties:
        lifetime:
          type: object
          properties:
            wins:
              type: integer
              format: uint32
            draws:
              type: integer
              format: uint32
            losses:
              type: integer
              format: uint32
          required:
            - wins
            - draws
            - losses
        daily:
          type: array
          items:
            type: object
            properties:
              wins:
                type: integer
                format: uint32
              draws:
                type: integer
                format: uint32
              losses:
                type: integer
                format: uint32
              day:
                type: string
                format: date
            required:
              - wins
              - draws
              - losses
              - day
          maxItems: 7
        recentMatches:
          type: array
          items:
            $ref: '#/components/schemas/GameResult'
          maxItems: 5
        recentTournaments:
          type: array
          items:
            $ref: '#/components/schemas/TournamentResult'
          maxItems: 5
    LocalGameSubmission:
      type: object
      required:
        - players
        - duration
      properties:
        players:
          type: array
          items:
            type: object
            properties:
              id:
                anyOf:
                  - type: integer
                    format: uint64
                  - type: string
              score:
                type: integer
                format: uint32
            required:
              - id
              - score
          minItems: 2
          maxItems: 4
        winnerId:
          anyOf:
            - type: integer
              format: uint64
            - type: string
        duration:
          type: string
          format: duration
    LocalTournamentSubmission:
      type: object
      required:
        - participants
        - games
      properties:
        participants:
          type: array
          items:
            type: object
            properties:
              id:
                anyOf:
                  - type: integer
                    format: uint64
                  - type: string
            required:
              - id
          minItems: 4
          maxItems: 4
        games:
          type: object
          properties:
            semifinal1:
              $ref: '#/components/schemas/LocalGameSubmission'
            semifinal2:
              $ref: '#/components/schemas/LocalGameSubmission'
            final:
              $ref: '#/components/schemas/LocalGameSubmission'
          required:
            - semifinal1
            - semifinal2
            - final
    MergePatchUpdate:
      type: object
      properties:
        username:
          type: string
        realname:
          type: string
          nullable: true
        avatarUrl:
          type: string
          format: uri
          nullable: true
        email:
          type: string
        password:
          type: string
      description: ''
    TournamentInvite:
      type: object
      required:
        - event
        - tournamentId
        - from
      properties:
        id:
          type: string
        event:
          type: string
          enum:
            - TournamentInvite
        tournamentId:
          type: string
        from:
          type: integer
          format: uint64
    TournamentKey:
      type: object
      required:
        - key
        - tournamentId
        - expires
      properties:
        key:
          type: string
        tournamentId:
          type: string
        expires:
          type: string
          format: date-time
    TournamentResult:
      type: object
      required:
        - id
        - date
        - participants
        - games
      properties:
        id:
          type: string
        date:
          type: string
          format: date-time
        participants:
          type: array
          items:
            type: object
            properties:
              id:
                anyOf:
                  - type: integer
                    format: uint64
                  - type: string
            required:
              - id
          minItems: 4
          maxItems: 4
        games:
          type: object
          properties:
            semifinal1:
              $ref: '#/components/schemas/GameResult'
            semifinal2:
              $ref: '#/components/schemas/GameResult'
            final:
              $ref: '#/components/schemas/GameResult'
          required:
            - semifinal1
            - semifinal2
            - final
    User.MutablePublicInfo:
      type: object
      required:
        - username
      properties:
        username:
          type: string
        realname:
          type: string
        avatarUrl:
          type: string
          format: uri
      description: Public facing info that can be mutated by the user
    User.PrivateInfo:
      type: object
      required:
        - email
      properties:
        email:
          type: string
    User.PublicInfo:
      type: object
      required:
        - id
      properties:
        id:
          type: integer
          format: uint64
          description: id = 0 is reserved for non-registered users
        lastSeen:
          type: string
          format: date-time
        registeredSince:
          type: string
          format: date-time
      allOf:
        - $ref: '#/components/schemas/User.MutablePublicInfo'
  securitySchemes:
    BearerAuth:
      type: http
      scheme: Bearer
